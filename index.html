// 1. Configuração: Não precisamos mais da API Key ou ModelID aqui no HTML!
const apiEndpoint = "/api/analyze"; // Rota que criaremos na Vercel

async function handleAnalysis() {
    // ... (mantenha a lógica de carregamento e limpeza de erros)
    
    try {
        const manualTranscript = transcriptInput.value.trim();
        const ccName = ccNameInput.value.trim();
        const readPromises = uploadedFiles.map(file => file.text());
        const fileTranscripts = await Promise.all(readPromises);
        const combinedTranscript = [manualTranscript, ...fileTranscripts].filter(Boolean).join('\n\n---\n\n');

        const analysisType = document.querySelector('input[name="analysis-type"]:checked').value;

        // Chamada para o SEU backend na Vercel
        const response = await fetch(apiEndpoint, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                transcript: combinedTranscript,
                ccName: ccName,
                analysisType: analysisType
            })
        });

        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || "Erro na análise.");
        }

        const data = await response.json();
        displayResults(data, analysisType);

    } catch (error) {
        // ... (mantenha seu tratamento de erro atual)
    }
}
